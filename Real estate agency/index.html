<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Агентство недвижимости</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://api-maps.yandex.ru/2.1/?&lang=ru_RU"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1560448204-e02f11c3d0e2');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease-in-out, transform 1s ease-in-out;
        }
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        #services {
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c');
            background-attachment: fixed;
            background-size: cover;
            background-position: center;
        }
        #map {
            width: 100%;
            height: 400px;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="font-sans text-gray-800 bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50 fade-in">
        <nav class="container mx-auto ml-8 pl-0 flex justify-between items-center">
            <img src="Images/truelogo.png" alt="Dream House Logo" class="h-28">
            <ul class="flex space-x-8 text-xl">
                <li><a href="#home" class="hover:text-blue-600 transition-colors duration-200">Главная</a></li>
                <li><a href="#apartments" class="hover:text-blue-600 transition-colors duration-200">Квартиры</a></li>
                <li><a href="#services" class="hover:text-blue-600 transition-colors duration-200">Преимущества</a></li>
                <li><a href="#sell" class="hover:text-blue-600 transition-colors duration-200">Продать</a></li>
                <li><a href="#contact" class="hover:text-blue-600 transition-colors duration-200">Контакты</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero-bg h-[700px] flex items-center fade-in">
        <div class="container mx-auto px-6 text-white text-center">
            <h1 class="text-5xl md:text-6xl font-bold mb-6">Найдите квартиру своей мечты</h1>
            <p class="text-xl md:text-2xl mb-8">Мы поможем вам купить или продать недвижимость быстро и выгодно</p>
            <h3 class="text-xl font-semibold text-gray-900 text-center mb-4">
                <a href="#apartments" class="bg-blue-600 text-white px-8 py-4 rounded-full hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">Посмотреть квартиры</a>
            </h3>
        </div>
    </section>

    <!-- Apartments Section -->
    <section id="apartments" class="py-20 bg-white fade-in">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-bold text-center mb-16">Доступные квартиры</h2>
            <div id="apartment-carousel">
                <div id="apartment-list" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
                <div class="flex justify-center mt-8">
                    <h3 class="text-xl font-semibold text-gray-900 text-center mb-4">
                    <button id="prev-button" class="bg-blue-600 text-white px-8 py-4 rounded-full hover:bg-blue-700 transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">Предыдущая</button>
                    </h3>
                    <span id="page-info" class="text-gray-700 mx-4 my-4"></span>
                    <h3 class="text-xl font-semibold text-gray-900 text-center mb-4">
                    <button id="next-button" class="bg-blue-600 text-white px-8 py-4 rounded-full hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">Следующая</button>
                    </h3>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-20 bg-gray-100 fade-in">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-bold text-center mb-16 text-white">Наши преимущества</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="text-center">
                    <i class="fas fa-clock text-4xl text-white mb-4"></i>
                    <p class="text-lg font-medium text-white">ЭКОНОМИМ ВРЕМЯ НА ПОИСК И ПРОВЕРКУ ОБЪЕКТОВ</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-gavel text-4xl text-white mb-4"></i>
                    <p class="text-lg font-medium text-white">РЕШИМ ВСЕ ЮРИДИЧЕСКИЕ ВОПРОСЫ</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-handshake text-4xl text-white mb-4"></i>
                    <p class="text-lg font-medium text-white">ПРОВЕДЕМ НЕОБХОДИМЫЕ ПЕРЕГОВОРЫ</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-phone text-4xl text-white mb-4"></i>
                    <p class="text-lg font-medium text-white">ОСТАНЕМСЯ НА СВЯЗИ ПОСЛЕ СДАЧИ РАБОТЫ</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-chart-line text-4xl text-white mb-4"></i>
                    <p class="text-lg font-medium text-white">ПРОАНАЛИЗИРУЕМ ТЕКУЩУЮ СИТУАЦИЮ НА РЫНКЕ</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-calculator text-4xl text-white mb-4"></i>
                    <p class="text-lg font-medium text-white">ОЦЕНИМ РЕАЛЬНУЮ СТОИМОСТЬ ОБЪЕКТА</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-user-tie text-4xl text-white mb-4"></i>
                    <p class="text-lg font-medium text-white">ЛИЧНЫЙ МЕНЕДЖЕР ДОСТУПЕН 7 ДНЕЙ В НЕДЕЛЮ</p>
                </div>
                <div class="text-center">
                    <i class="fas fa-eye text-4xl text-white mb-4"></i>
                    <p class="text-lg font-medium text-white">ПРОЗРАЧНЫЕ УСЛОВИЯ, БЕЗ СКРЫТЫХ ПЛАТЕЖЕЙ</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Sell Section -->
    <section id="sell" class="py-20 bg-gray-100 fade-in">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-bold text-center mb-16">Продайте свою квартиру</h2>
            <div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-2xl">
                <h3 class="text-xl font-semibold text-gray-900 text-center mb-4">Оставьте заявку
                <form id="sell-form" class="mt-4" action="submit_seller.php" method="POST">
                    <input type="text" name="name" placeholder="Имя" class="w-full px-4 py-3 mt-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <input type="text" name="surname" placeholder="Фамилия" class="w-full px-4 py-3 mt-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <input type="tel" name="phone" placeholder="Телефон: 89519713859" class="w-full px-4 py-3 mt-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <input type="email" name="email" placeholder="Email" class="w-full px-4 py-3 mt-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <button type="submit" class="mt-6 w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">Отправить</button>
                </h3>
                </form>
            </div>
        </div>
    </section>

    <!-- Map Section -->
    <section id="map-section" class="w-full fade-in">
        <div id="map" class="w-full"></div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-20 bg-white fade-in">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-4xl font-bold mb-8">Свяжитесь с нами</h2>
            <p class="text-lg mb-4">Телефон: 8 (951) 971-38-59</p>
            <p class="text-lg mb-4">Email: info@realty.ru</p>
            <p class="text-lg">Адрес: Санкт-Петербург, Кондратьевский просп., 46</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>© 2025 Агентство недвижимости. Все права защищены.</p>
        </div>
    </footer>

    <!-- Contact Modal -->
    <div id="contact-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="relative p-6 border w-full max-w-md shadow-2xl rounded-xl bg-white transform transition-all duration-300 scale-95 modal-content">
            <div class="text-center">
                <h3 class="text-xl font-semibold text-gray-900">Связаться с нами
                <form id="contact-form" class="mt-4" action="submit_contact.php" method="POST">
                    <input type="text" name="name" placeholder="Имя" class="w-full px-4 py-3 mt-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <input type="text" name="surname" placeholder="Фамилия" class="w-full px-4 py-3 mt-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <input type="tel" name="phone" placeholder="Телефон: 89519713859" class="w-full px-4 py-3 mt-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <input type="email" name="email" placeholder="Email" class="w-full px-4 py-3 mt-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <button type="submit" class="mt-6 w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">Отправить</button>
                </h3>
                </form>
                <button id="close-modal" class="absolute top-0 right-0 mt-4 mr-4 text-gray-500 hover:text-gray-700 transition-colors duration-200">✕</button>
            </div>
        </div>
    </div>

    <script>
        let allApartments = [];
        let currentPage = 1;
        let totalPages = 0;

        // Функция для заполения карусели
        function renderCarouselPage(page) {
            const start = (page - 1) * 9;
            const end = start + 9;
            const pageApartments = allApartments.slice(start, end);

            const apartmentList = document.getElementById('apartment-list');
            apartmentList.innerHTML = '';

            pageApartments.forEach(apartment => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-2xl';
                card.innerHTML = `
                    <img src="${apartment.image ? `/Images/Realty/${apartment.image}` : 'https://via.placeholder.com/300x200'}" alt="${apartment.realty_rooms}-комнатная ${apartment.realty_type_name}" class="w-full h-56 object-cover">
                    <div class="p-6">
                        <h3 class="text-2xl font-semibold text-gray-800">${apartment.realty_rooms}-комнатная ${apartment.realty_type_name}</h3>
                        <p class="text-gray-600 mt-2">${apartment.realty_address}</p>
                        <p class="text-blue-600 font-bold mt-4 text-xl">${new Intl.NumberFormat('ru-RU').format(apartment.realty_price)} ₽</p>
                        <h3 class="text-xl font-semibold text-gray-900">
                        <button type="button" class="contact-button block mt-6 w-full text-center bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">Связаться</button>
                        </h3>
                    </div>
                `;
                apartmentList.appendChild(card);
            });

            // Счётчик страниц карусел
            document.getElementById('page-info').textContent = `${page} из ${totalPages}`;

            // Включение/отключение кнопок навигации
            document.getElementById('prev-button').disabled = page === 1;
            document.getElementById('next-button').disabled = page === totalPages;

            // Определние кнопок "Связаться"
            const contactButtons = document.querySelectorAll('.contact-button');
            contactButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const contactModal = document.querySelector('#contact-modal');
                    contactModal.classList.remove('opacity-0', 'pointer-events-none');
                    contactModal.classList.add('opacity-100');
                    const modalContent = contactModal.querySelector('.modal-content');
                    modalContent.classList.remove('scale-95');
                    modalContent.classList.add('scale-100');
                });
            });
        }

        // Функция для загрузки недвижимости в карсуль
        async function loadRealty() {
            try {
                const response = await fetch('Real_estate_website/get_realties.php');
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                allApartments = await response.json();
                totalPages = Math.ceil(allApartments.length / 9);
                renderCarouselPage(1);
            } catch (error) {
                console.error('Ошибка загрузки недвижимости:', error);
                alert('Не удалось загрузить данные о недвижимости. Проверьте консоль для деталей.');
            }
        }

        // Логика кнопкок: "Следующая" и "Предыдущая"
        document.getElementById('prev-button').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderCarouselPage(currentPage);
            }
        });

        document.getElementById('next-button').addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                renderCarouselPage(currentPage);
            }
        });

        // Закрытие модального окна
        const closeModal = document.querySelector('#close-modal');
        closeModal.addEventListener('click', () => {
            const contactModal = document.querySelector('#contact-modal');
            contactModal.classList.remove('opacity-100');
            contactModal.classList.add('opacity-0', 'pointer-events-none');
            const modalContent = contactModal.querySelector('.modal-content');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
        });

        // Обработка формы продажи
        document.getElementById('sell-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            try {
                const response = await fetch('Real_estate_website/submit_seller.php', {
                    method: 'POST',
                    body: formData
                });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const result = await response.json();
                alert(result.message);
                e.target.reset();
            } catch (error) {
                console.error('Ошибка:', error);
                alert(`Ошибка при отправке заявки: ${error.message}`);
            }
        });

        // Обработка формы контакта
        document.getElementById('contact-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            try {
                const response = await fetch('Real_estate_website/submit_contact.php', {
                    method: 'POST',
                    body: formData
                });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const result = await response.json();
                alert(result.message);
                e.target.reset();
                const contactModal = document.querySelector('#contact-modal');
                contactModal.classList.remove('opacity-100');
                contactModal.classList.add('opacity-0', 'pointer-events-none');
                const modalContent = contactModal.querySelector('.modal-content');
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
            } catch (error) {
                console.error('Ошибка:', error);
                alert(`Ошибка при отправке заявки: ${error.message}`);
            }
        });

        // Анимация при скролле
        const sections = document.querySelectorAll('.fade-in');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        sections.forEach(section => {
            observer.observe(section);
        });

        // Инициализация Яндекс.Карты
        let mapInitialized = false;

        async function initMap(address = "Санкт-Петербург, Кондратьевский просп., 46") {
            if (mapInitialized) return;
            if (typeof ymaps === 'undefined') {
                console.error("Библиотека Яндекс.Карт не загружена");
                return;
            }

            try {
                await ymaps.ready;

                const geocodeResponse = await fetch(
                    `https://geocode-maps.yandex.ru/1.x/?apikey=9751f591-5396-435b-b7e1-da796d1deffb&geocode=${encodeURIComponent(address)}&format=json`
                );
                const data = await geocodeResponse.json();

                if (!data.response?.GeoObjectCollection?.featureMember?.length) {
                    alert("Адрес не найден");
                    return;
                }

                const pos = data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos;
                const coordinates = pos.split(" ").map(Number).reverse();

                const map = new ymaps.Map('map', {
                    center: coordinates,
                    zoom: 15
                });

                map.geoObjects.add(new ymaps.Placemark(coordinates));
                mapInitialized = true;
            } catch (error) {
                console.error("Ошибка геокодирования:", error);
            }
        }

        // Вызов инициализации карты и загрузки недвижимости при загрузке страницы
        window.onload = function() {
            initMap();
            loadRealty();
        };
    </script>
</body>
</html>